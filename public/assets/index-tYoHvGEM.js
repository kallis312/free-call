import{u as c,j as s,S as o,a as p,h as w,r as u}from"./index-xUncabY_.js";import{A as b}from"./AppModal-pPJSzXne.js";import{I as y}from"./ImageHeader-g8ib3Pwz.js";import"./GoBack-kP0uJgbc.js";const N=({contact:e,isOpen:f,setIsOpen:a=()=>{},loadContact:m})=>{const x=c(),h=async d=>{try{const{isConfirmed:l}=await o.fire({icon:"warning",text:`Do you remove ${e==null?void 0:e.name} - ${e==null?void 0:e.phone}?`,showCancelButton:!0,confirmButtonText:"はい",cancelButtonText:"Reject"});l&&(await p.delete("/contacts/"+d),m(),await o.fire({icon:"success",text:"Deleted successfully.",confirmButtonText:"はい"}),a(!1))}catch(l){o.fire({icon:"error",text:l instanceof Error?l.message:"Unknown Error.",confirmButtonText:"はい"})}},t=async(d,l)=>{try{await p.put("/contacts/"+d,{contact:{name:e==null?void 0:e.name,phone:e==null?void 0:e.phone,email:e==null?void 0:e.email,type:l}}),await o.fire({icon:"success",text:"Updated successfully.",confirmButtonText:"はい"}),a(!1),m()}catch(r){o.fire({icon:"error",text:r instanceof Error?r.message:"Unknown Error.",confirmButtonText:"はい"})}};return s.jsxs(b,{isOpen:f,setIsOpen:a,children:[s.jsxs("div",{children:[e==null?void 0:e.name,", ",(e==null?void 0:e.phone)||(e==null?void 0:e.email)]}),s.jsxs("div",{className:"grid-cols-2 gap-3 grid",children:[s.jsx("button",{children:s.jsx("img",{src:"/rsc/call_btn.png",width:120,className:"h-[77px]"})}),s.jsx("button",{children:s.jsx("img",{src:"/rsc/amend_btn.png",width:120,className:"h-[77px]"})}),(e==null?void 0:e.type)==="company"?s.jsx("button",{onClick:()=>t(e.id,"personal"),children:s.jsx("img",{src:"/rsc/5.png",width:120,className:"h-[77px]"})}):e&&s.jsx("button",{onClick:()=>t(e.id,"company"),children:s.jsx("img",{src:"/rsc/6.jpg",width:120,className:"h-[77px]"})}),s.jsx("button",{children:s.jsx("img",{src:"/rsc/goback_btn.png",onClick:()=>a(!1),width:120,className:"h-[77px]"})})]}),s.jsx("div",{children:s.jsx("button",{onClick:()=>x("/calling/send/"+(e==null?void 0:e.phone)),className:"w-full red-grad-bg py-3 text-white text-2xl font-bold rounded-md mt-3 border-4 border-red-600 shadow-lg",children:"履歴から削除"})}),s.jsx("div",{className:"flex justify-center mt-3",children:s.jsx("button",{onClick:()=>(e==null?void 0:e.id)&&h(e.id),children:s.jsx("img",{src:"/rsc/delete_btn.png",width:120,className:"h-[77px]"})})})]})},j="contacts"in navigator,B=()=>{const{type:e}=w(),[f,a]=u.useState([]),[m,x]=u.useState(!1),h=u.useRef();u.useEffect(()=>{if(e)t(e);else throw Error("Type Error.")},[e]);const t=async r=>{try{const{data:i}=await p.get("/contacts",{params:{type:r}});a(i)}catch(i){o.fire({icon:"error",text:i instanceof Error?i.message:"Unknown Error.",confirmButtonText:"はい"})}},d=async()=>{try{if(j&&e){const r=await navigator.contacts.select(["name","email","tel"],{multiple:!0});console.log(r);const i=[];r.forEach(n=>{var g;(g=n.tel)!=null&&g.length&&n.tel[0]&&i.push({email:n.email.length?n.email[0]:null,name:n.name.length?n.name[0]:n.tel[0],phone:n.tel[0]})}),i.length&&(await p.post("/contacts",{contacts:i,type:e}),t(e))}}catch{o.fire({icon:"error",confirmButtonText:"はい"})}},l=r=>{h.current=r,x(!0)};return s.jsx(s.Fragment,{children:s.jsxs("div",{className:"bg-primary w-full h-full flex flex-col overflow-auto",children:[s.jsx(y,{}),s.jsxs("div",{className:"p-2 border-b border-solid border-gray-300 flex justify-between items-end",children:[s.jsx("div",{className:"text-red-400 text-xs",children:"連絡先リストが空です"}),e!=="all"&&j&&s.jsx("button",{onClick:d,className:"bg-[#00B050] py-1 px-2 shadow-md text-white",children:"連絡先をロード"})]}),s.jsx("div",{className:"h-full mt-1 overflow-auto flex flex-col",children:f.map((r,i)=>s.jsxs("div",{className:"border-b p-2 border-gray-300 rounded-sm",onClick:()=>l(r),children:[s.jsx("div",{children:r.name||"Unknown User"}),s.jsx("div",{className:"text-lg",children:r.phone||"No Phone Number"})]},i))}),s.jsx(N,{contact:h.current,isOpen:m,setIsOpen:x,loadContact:()=>e&&t(e)})]})})};export{B as default};
